/*
 * gulp-tomcat
 *
 *
 * Copyright (c) 2016 Santiago Varela
 * Licensed under the MIT license.
 */

'use strict';
var gulp = require('gulp'),
    gutil = require('gulp-util'),
    maven = require('maven-deploy'),
    pom = require('./pom'),
    args = require('yargs').argv,
    fs = require('fs'),
    fstream = require('fstream'),
    server = require('./tasks/tomcat'),
    pom = require('./pom');

// Start / Stop server Tomcat server
var cmd = args.start ? 'start' : args.stop ? 'stop' : null;
gulp.task('server', function() {
  server.toggle(cmd);
});

// Build maven .war or .jar using our pom.json
gulp.task('build', function(){
    maven.config(pom);
    maven.package();
});

//  Deploy .war to local Tomcat server
gulp.task('local', ['build'], function () {
  return gulp
    .src(process.cwd()+'/'+pom.buildDir+'/'+pom.finalName+'.war')
    .pipe(gulp.dest(pom.localDir));
});

//  Deploy .war to AWS Tomcat server
gulp.task('deploy', ['build'], function () {
  gulp.dest(pom.execDeploy);
});

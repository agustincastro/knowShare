/*
 * gulp-tomcat
 *
 *
 * Copyright (c) 2016 Santiago Varela
 * Licensed under the MIT license.
 */


'use strict';
var gulp = require('gulp'),
    gutil = require('gulp-util'),
    maven = require('maven-deploy'),
    pom = require('./pom'),
    args = require('yargs').argv,
    fs = require('fs'),
    fstream = require('fstream'),
    server = require('./tasks/tomcat'),
    pom = require('./pom');

// Start / Stop server
var cmd = args.start ? 'start' : args.stop ? 'stop' : null;
gulp.task('server', function() {
  server.toggle(cmd);
});


// Build maven .war or .jar using our pom.json
gulp.task('build-mvn', function(){
    maven.config(pom);
    maven.package();
});

//  Copy .war to server
gulp.task('copy', function () {
  //gutil.replaceExtension(process.cwd()+'/'+pom.buildDir+'/'+pom.finalName+'.'+pom.type, '.zip');
  return gulp
    .src(process.cwd()+'/'+pom.buildDir+'/'+pom.finalName)
    .pipe(gulp.dest(pom.deployDir));
});

gulp.task('deploy', function () {
  server.deploy(pom.finalName);
});
